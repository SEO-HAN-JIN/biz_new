<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/framelayout}">


<div layout:fragment="content">

    <div class="page-heading">
        <div class="page-title">
            <div class="row">
                <div class="col-12 col-md-6 order-md-1 order-last p-3">
                    <h3>환불관리</h3>
                </div>
                <div class="col-12 col-md-6 order-md-2 order-first">
                    <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">정산관리</li>
                            <li class="breadcrumb-item active" aria-current="page">환불요청</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>

        <section id="horizontal-input">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body pt-3 pb-3" id="searchForm">
<!--                            <div class="row align-items-center p-2" style="">-->
                            <div class="row align-items-center p-2 search-area custom-bg">
                                <div class="col-md-11">
                                    <div class="form-group row mb-0 align-items-center text-center">
                                        <label class="col-form-label col-lg-1 col-3">날짜</label>
                                        <div class="col-lg-3 col-9">
                                            <div class="d-flex">
                                                <input type="date" class="form-control form-control-sm me-2" id="searchStartDate" >
                                                <input type="date" class="form-control form-control-sm" id="searchEndDate" >
                                            </div>
                                        </div>
                                        <label class="col-form-label col-lg-1 col-3">고객명</label>
                                        <div class="col-lg-2 col-9">
                                            <input type="text" id="custName" class="form-control form-control-sm" name="fname" placeholder="메뉴명">
                                        </div>
                                        <label class="col-form-label col-lg-1 col-3">상품명</label>
                                        <div class="col-lg-2 col-9">
                                            <input type="text" id="prodName" class="form-control form-control-sm" name="fname" placeholder="메뉴명">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-1 text-end">
                                    <a href="#" class="btn btn-primary cursor-auto" id="searchBtn">조회</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="row" id="basic-table">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">정산신청내역</h4>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-end" style="width: 100%;">
                                <div class="d-flex pb-3 gap-1">
                                    <button type="button" class="btn btn-primary btn-m" id="modalAddBtn" data-bs-toggle="modal" data-bs-target="#paymentModal">추가</button>

                                    <button type="button" class="btn btn-secondary btn-m" id="btnDeletePaymentGrid">삭제</button>
                                </div>
                            </div>
                            <div id="paymentGrid" class="tui-grid"></div>
                        </div>

                        <div class="modal fade" id="paymentModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" data-bs-backdrop="static">
                            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
                                <div class="modal-content">
                                    <!-- Modal Header -->
                                    <div class="modal-header bg-primary text-white">
                                        <h5 class="modal-title" id="exampleModalCenterTitle">정산요청 상세정보</h5>
                                        <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>

                                    <!-- Modal Body -->
                                    <div class="modal-body">
                                        <form class="form">
                                            <!-- 기본 정보 섹션 -->
                                            <fieldset class="border p-3 rounded">
                                                <legend class="float-none w-auto px-2">기본 정보</legend>
                                                <div class="row g-3">
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">담당자</label>
                                                            <input type="text" id="pUserId" class="form-control" name="fname-column" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">고객</label>
                                                            <th:block th:replace="components/cust-select :: cust-select(
                                                                id='custId',
                                                                name='custName')"></th:block>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">상품</label>
                                                            <th:block th:replace="components/prod-select :: prod-select(
                                                                id='prodId',
                                                                name='prodName')"></th:block>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">상품가</label>
                                                            <input type="text" id="prodAmt" class="form-control is-num text-end" name="prodAmt">
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>

                                            <!-- 정산 정보 섹션 -->
                                            <fieldset class="border p-3 rounded mt-4">
                                                <legend class="float-none w-auto px-2">정산 정보</legend>
                                                <div class="row g-3">
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">작업시작일</label>
                                                            <input type="date" id="dateWorkFrom" class="form-control" name="dateWorkFrom">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">작업종료일</label>
                                                            <input type="date" id="dateWorkTo" class="form-control" name="dateWorkTo">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">작업일수</label>
                                                            <input type="number" id="workDay" class="form-control" name="workDay" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">판매가</label>
                                                            <input type="text" id="saleAmt" class="form-control is-num text-end" name="saleAmt">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row g-3">
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">유입수</label>
                                                            <input type="text" id="inflowCnt" class="form-control" name="inflowCnt">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">판매총액</label>
                                                            <input type="text" id="saleTotalAmt" class="form-control is-num text-end" name="saleTotalAmt" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">예상정산금액</label>
                                                            <input type="text" id="acctAmt" class="form-control is-num text-end" name="acctAmt" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">요청구분</label>
                                                            <select id="status" class="form-select form-control-sm">
                                                                <option value="1">신규</option>
                                                                <option value="2">연장</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>

                                            <!-- 킵 사용 설정 섹션 -->
                                            <fieldset class="border p-3 rounded mt-4">
                                                <legend class="float-none w-auto px-2">킵 사용 설정</legend>
                                                <div class="row g-3 align-items-center">
                                                    <div class="col-md-2">
                                                        <div class="form-check form-switch">
                                                            <input class="form-check-input" type="checkbox" id="pKeepInd" onchange="selectKeepInd(this)">
                                                            <label class="form-check-label" for="pKeepInd">킵사용</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <div class="input-group">
                                                            <span class="input-group-text" id="basic-addon1">잔여킵금액</span>
                                                            <input type="text" class="form-control" id="custKeepAmt" aria-describedby="basic-addon1" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <div class="input-group">
                                                            <span class="input-group-text" id="basic-addon2">킵사용금액</span>
                                                            <input type="text" class="form-control" id="custKeepUseAmt" aria-describedby="basic-addon2" disabled>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>

                                    <!-- Modal Footer -->
                                    <div class="modal-footer bg-light">
                                        <button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">
                                            <i class="bx bx-x"></i> 닫기
                                        </button>
                                        <button type="button" class="btn btn-primary ms-1" id="modalSaveBtn">
                                            <i class="bx bx-check"></i> 저장
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="modal fade" id="refundModal" tabindex="-1" role="dialog" aria-labelledby="refundModalTitle" aria-hidden="true" data-bs-backdrop="static">
                            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
                                <div class="modal-content">
                                    <!-- Modal Header -->
                                    <div class="modal-header bg-primary text-white">
                                        <h5 class="modal-title" id="refundModalTitle">테스트</h5>
                                        <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>

                                    <!-- Modal Body -->
                                    <div class="modal-body">
                                        <form class="form">
                                            <!-- 기본 정보 섹션 -->
                                            <fieldset class="border p-3 rounded">
                                                <legend class="float-none w-auto px-2">기본 정보</legend>
                                                <div class="row g-3">
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">담당자</label>
                                                            <input type="text" id="pUserId2" class="form-control" name="fname-column" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">고객</label>
                                                            <th:block th:replace="components/cust-select :: cust-select(
                                                                id='custId',
                                                                name='custName')"></th:block>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">상품</label>
                                                            <th:block th:replace="components/prod-select :: prod-select(
                                                                id='prodId',
                                                                name='prodName')"></th:block>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">상품가</label>
                                                            <input type="text" id="prodAmt2" class="form-control is-num text-end" name="prodAmt">
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>

                                            <!-- 정산 정보 섹션 -->
                                            <fieldset class="border p-3 rounded mt-4">
                                                <legend class="float-none w-auto px-2">정산 정보</legend>
                                                <div class="row g-3">
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">작업시작일</label>
                                                            <input type="date" id="dateWorkFrom2" class="form-control" name="dateWorkFrom">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">작업종료일</label>
                                                            <input type="date" id="dateWorkTo2" class="form-control" name="dateWorkTo">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">작업일수</label>
                                                            <input type="number" id="workDay2" class="form-control" name="workDay" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">판매가</label>
                                                            <input type="text" id="saleAmt2" class="form-control is-num text-end" name="saleAmt">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row g-3">
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">유입수</label>
                                                            <input type="text" id="inflowCnt2" class="form-control" name="inflowCnt">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">판매총액</label>
                                                            <input type="text" id="saleTotalAmt2" class="form-control is-num text-end" name="saleTotalAmt" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">예상정산금액</label>
                                                            <input type="text" id="acctAmt2" class="form-control is-num text-end" name="acctAmt" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="form-label">요청구분</label>
                                                            <select id="status2" class="form-select form-control-sm">
                                                                <option value="1">신규</option>
                                                                <option value="2">연장</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>

                                            <!-- 킵 사용 설정 섹션 -->
                                            <fieldset class="border p-3 rounded mt-4">
                                                <legend class="float-none w-auto px-2">킵 사용 설정</legend>
                                                <div class="row g-3 align-items-center">
                                                    <div class="col-md-2">
                                                        <div class="form-check form-switch">
                                                            <input class="form-check-input" type="checkbox" id="pKeepIn2d" onchange="selectKeepInd(this)">
                                                            <label class="form-check-label" for="pKeepInd">킵사용</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <div class="input-group">
                                                            <span class="input-group-text" id="basic-addon12">잔여킵금액</span>
                                                            <input type="text" class="form-control" id="custKeepAmt2" aria-describedby="basic-addon1" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <div class="input-group">
                                                            <span class="input-group-text" id="basic-addon22">킵사용금액</span>
                                                            <input type="text" class="form-control" id="custKeepUseAmt2" aria-describedby="basic-addon2" disabled>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>

                                    <!-- Modal Footer -->
                                    <div class="modal-footer bg-light">
                                        <button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">
                                            <i class="bx bx-x"></i> 닫기
                                        </button>
                                        <button type="button" class="btn btn-primary ms-1" id="modalSaveBtn2">
                                            <i class="bx bx-check"></i> 저장
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>
    </div>
    <script type="text/javascript">

        const apiUrl = '/api/pages/applypayment';

        let paymentGrid;
        let menuGrid;
        let $isNew = 'N';

        $(document).ready(function() {

            const nowYear = new Date().getFullYear();
            const nowMonth = new Date().getMonth();

            const startDate = new Date(nowYear, nowMonth, 1); // 당월 1일
            const endDate = new Date(nowYear, nowMonth + 1, 0); // 현재 달의 마지막 날

            // 포맷팅된 날짜 값을 input에 설정
            $("#searchStartDate").val(formatDate(startDate));
            $("#searchEndDate").val(formatDate(endDate));


            initEvent();
            initPaymentGrid();
        });

        const initEvent = () => {
            $("#modalAddBtn").on('click', openPgmModal);
            $("#modalSaveBtn").on('click', fn_savePaymentGrid);

            $("#searchBtn").on('click', searchPaymentGrid);

            // 숫자 input 콤마 형식
            $(".priceformat").on('input', function(){
                var obj = $(this);
                obj.val(formatNumber(obj.val()));
            });

            // 판매시작일, 판매종료일, 판매가, 유입수 입력 이벤트 설정
            const elements = ['dateWorkFrom', 'dateWorkTo', 'saleAmt', 'inflowCnt'];

            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener("change", function(){

                        if(id == "dateWorkFrom" || id == "dateWorkTo")
                            $("#workDay").val(getDateDiff($("#dateWorkFrom").val(), $("#dateWorkTo").val()))

                        saleSum();
                    });
                }
            });
        }


        function selectKeepInd(obj) {

            var keepInd = obj.checked;

            var inputElement = $("#custKeepUseAmt");

            if (keepInd) {
                // Enable the element
                $(inputElement).prop("disabled", false);
            } else {
                // Disable the element
                $(inputElement).prop("disabled", true);
            }
        }

        function saleSum()
        {

            var saleAmt = isNull($("#saleAmt").val()) ? 0 : parseInt($("#saleAmt").val());
            var prodAmt = isNull($("#prodAmt").val()) ? 0 : parseInt($("#prodAmt").val());
            var inflowCnt = isNull($("#inflowCnt").val()) ? 0 : parseInt($("#inflowCnt").val());
            var workDay = isNull($("#workDay").val()) ? 0 : parseInt($("#workDay").val());

            // 부가세율 설정 (10% 부가세)
            var vatRate = 1.1;

            // 판매총액 (판매가 * 유입수 * 작업일) - 부가세 포함
            var saleTotalAmt = Math.floor((saleAmt * inflowCnt * workDay) * vatRate);

            // 상품가기준 판매총액 (상품가 * 유입수 * 작업일) - 부가세 포함
            var prodTotalAmt = Math.floor((prodAmt * inflowCnt * workDay) * vatRate);

            // 영업이익
            var costAmt = saleTotalAmt - prodTotalAmt;

            // 데이터로 저장된 인센율을 문자열로 가져왔다고 가정
            var incenRateStr = "0.3"; // 문자열로 저장된 0.3

            // 실수형으로 변환
            var incentiveRate = parseFloat(incenRateStr);

            // 소수점 제외하고 정수만 출력
            var rate = Math.floor(costAmt * incentiveRate);

            $("#acctAmt").val(formatNumber(rate));
            $("#saleTotalAmt").val(formatNumber(saleTotalAmt));
        }

        const getDateDiff = (d1, d2) => {

            const date1 = new Date(d1);
            const date2 = new Date(d2);

            const diffDate = date1.getTime() - date2.getTime();

            return (Math.abs(diffDate / (1000 * 60 * 60 * 24)) + 1); // 밀리세컨 * 초 * 분 * 시 = 일
        }

        function performAction()
        {

        }

        const initPaymentGrid = () => {


            var columns = new CustomTuiGrid()
                .setFitStyle('fill')  // 페이지 폭에 맞추어 그리드를 채우기
                .add('settlementSeq', '정산번호', 150, {})
                .add('empName', '담당자', 150, {})
                .add('custName', '고객명', 250, {})
                .add('prodName', '상품명', 200, { align: 'center' })
                .add('prodAmt', '상품가', 150, { align: 'right'})
                .add('saleAmt', '판매가', 120, { align: 'right' })
                .add('inflowCnt', '유입수', 120, {})
                .addDate('dateWorkFrom', '작업시작일', 150, {})
                .addDate('dateWorkTo', '작업종료일', 150, {})
                .addDate('workDay', '작업일수', 150, {})
                .addNumber('saleTotalAmt', '판매총액', 200, {
                    align: 'right',
                    textColor: 'red',
                    comma: true,
                    summary: {
                        template: valueMap => `합계: ${valueMap.sum.toLocaleString()}`
                    }})
                .addNumber('depositRealAmt', '실제입금액', 200, { align: 'right', textColor: 'red' })
                .add('statusName', '진행상태', 150, {})

            paymentGrid = columns.init('paymentGrid', [])
                .render();

            // 더블 클릭 이벤트 설정
            paymentGrid.getGrid().on('dblclick', function(ev) {
                openPgmModal('2');
            });

            searchPaymentGrid();
        }

        const searchPaymentGrid = () => {
            paymentGrid.clear();

            const param = {
                menuNm : $("#first-name").val()
            };

            $.ajax({
                url: apiUrl,
                data: param,
                type: 'GET',
                success: (result) => {

                    if(result.length > 0) {

                        // result.forEach((item) => {
                        //     item.saleTotalAmt = item.saleTotalAmt.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                        // });

                        paymentGrid.bind(result);
                    }
                }
            });
        }

        const openPgmModal = (param) => {

            console.log("## gdgd ##");
            // if (param === '1') {
            //     $isNew = true;
            // } else {
            //     $isNew = false;
            // }
            //
            // clearForm('paymentModal');
            //
            // // 추가 버튼 클릭 시
            // if (param === '2') {
            //     const focusedCell = paymentGrid.getGrid().getFocusedCell();
            //     const focusedData = paymentGrid.getGrid().getRow(focusedCell.rowKey);
            //
            //     $('#paymentModal').find('input, select, textarea').each(function() {
            //         const fieldId = $(this).attr('id');
            //         if (fieldId && focusedData[fieldId] !== undefined) {
            //             if ($(this).is(':checkbox')) {
            //                 // 체크박스는 'Y', 'N' 또는 true/false로 값을 바인딩
            //                 $(this).prop('checked', focusedData[fieldId] === 'Y' || focusedData[fieldId] === true);
            //             } else if ($(this).is('select')) {
            //                 var obj = document.getElementById(fieldId);
            //
            //                 if (obj && obj.classList.contains('choices')) {
            //                     // Choices.js를 사용하는 select
            //                     if (obj.choicesInstance) {
            //                         // Choices.js 인스턴스가 있는 경우 값 설정
            //                         obj.choicesInstance.setChoiceByValue(focusedData[fieldId]);
            //                     } else {
            //                         // 인스턴스가 없는 경우 새로 생성 후 값 설정
            //                         const choicesInstance = new Choices(obj);
            //                         choicesInstance.setChoiceByValue(focusedData[fieldId]);
            //                         obj.choicesInstance = choicesInstance; // 참조 저장
            //                     }
            //                 } else {
            //                     // 일반 select 박스
            //                     $(this).val(focusedData[fieldId]);
            //                 }
            //             } else if (fieldId === 'mileage') {
            //                 $("#mileagePrev").val(focusedData[fieldId]);
            //                 const replaceNumber = formatToCurrency(focusedData[fieldId]);
            //                 $(this).val(replaceNumber);
            //             } else {
            //                 // 그 외 input, textarea는 값 바인딩
            //                 $(this).val(focusedData[fieldId]);
            //             }
            //         }
            //     });
            // }

            $('.modal').modal('hide'); // 기존에 열려 있는 모든 모달 닫기
            $('#refundModal').modal('show');
            $('.modal').modal('hide');

        }

        const clearForm = (id) => {
            $('#' + id).find('input, select, textarea').each(function () {
                if ($(this).is(':checkbox')) {
                    // 체크박스는 체크 해제
                    $(this).prop('checked', false);
                } else if ($(this).is('select')) {
                    const obj = this;
                    if (obj.classList.contains('choices') && obj.choicesInstance) {
                        // Choices.js가 적용된 select 초기화
                        obj.choicesInstance.setChoiceByValue(''); // 선택값 초기화
                    } else {
                        // 일반 select는 첫 번째 값으로 초기화
                        $(this).val($(this).find('option:first').val());
                    }
                } else {
                    // 나머지 input 및 textarea는 빈 값으로 초기화
                    $(this).val('');
                }
            });
        };


        const fn_savePaymentGrid = () => {
            const param = {};
            $('#paymentModal').find('input, select, input[type="checkbox"]').each((index, item) => {
                // checkbox일 때
                if ($(item).is(':checkbox')) {
                    param[item.id] = $(item).prop('checked') ? 'Y' : 'N'; // 체크 여부에 따라 Y 또는 N 설정
                } else {
                    // input일 때의 처리
                    param[item.id] = item.value.replace(/,/g, ''); // input 값 설정
                }
            });

            var dateFrom = param.dateWorkFrom;
            var dateTo = param.dateWorkTo;
            if(isNull(dateFrom))
            {
                alert("시작일을 입력해주세요.");
                return false;
            }

            if(isNull(dateTo))
            {
                alert("종료일을 입력해주세요.");
                return false;
            }

            if(new Date(dateTo) < new Date(dateFrom))
            {
                alert("작업기간이 잘못되었습니다.");
                return false;
            }

            if (isNull(param.saleAmt)) {
                alert("판매가를 입력해주세요.");
                return false;
            }

            if (isNull(param.inflowCnt)) {
                alert("유입수를 입력해주세요.");
                return false;
            }

            if (isNull(param.saleTotalAmt)) {
                alert("판매총액을 입력해주세요.");
                return false;
            }

            // if (isNull(param.depositAmt)) {
            //     alert("입금총액을 입력해주세요.");
            //     return false;
            // }

            if (confirm("데이터를 저장하시겠습니까?")) {
                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: apiUrl,
                        data: JSON.stringify(param),
                        contentType: 'application/json',
                        type: 'POST',
                        success: (result) => {
                            if (result > 0) {
                                alert("저장이 완료되었습니다.");
                                return true;
                            } else {
                                alert("저장에 실패하였습니다.");
                                return false;
                            }
                        }, error: (xhr, status, error) => {
                            alert(xhr.responseText);
                            return false;
                        }
                    })
                });
            }
        }

        const fn_deletePaymentGrid = () => {
            const focusedCell = paymentGrid.getFocusedCell();
            if (isNull(focusedCell)) {
                alert("삭제할 행을 선택해주세요.");
                return;
            }

            const confirmResult = confirm("선택한 행의 데이터를 삭제하시겠습니까?");
            if (confirmResult) {
                const focusRow = paymentGrid.getRow(focusedCell.rowKey);
                let params = {
                    menuId : focusRow.menuId
                }
                $.ajax({
                    url: apiUrl + "/up/list",
                    data: JSON.stringify(params),
                    contentType:'application/json',
                    type: 'DELETE',
                    success: (result) => {
                        if (result > 0) {
                            alert("삭제가 완료되었습니다.");
                            searchPaymentGrid();
                        } else {
                            alert("삭제에 실패하였습니다.");
                            searchPaymentGrid();
                        }
                    }
                })
            }
        }

        const closeBeforeModal = () => {
            console.log('모달이 곧 닫힙니다!');
        }

        const closeAfterModal = () => {
            console.log('모달이 닫혔습니다!');
        }

        const modalAcceptBtn = () => {
            searchPaymentGrid();
        }


        // function openPop(url, options) {
        //     if(self != top) {
        //         window.parent.openPop(url, options);
        //         return;
        //     }
        //     var container = document.getElementById("popup-container");
        //     if(container instanceof HTMLDivElement === false) {
        //         container = document.createElement("div");
        //         container.id = "popup-container";
        //         container.className = "popup-container";
        //         container.style.opacity = "0";
        //         container.style.display = "none";
        //         document.body.appendChild(container);
        //     }
        //     container.innerHTML = "";
        //
        //     var popId = _.camelCase(_.nth(_.split(url, "/"), -2));
        //     if(!_.isEmpty(window[popId])) {
        //         window[popId].open(options);
        //     }
        //     else {
        //         fetch(url)
        //             .then(function(response) {
        //                 return response.text();
        //             })
        //             .then(function(text) {
        //                 container.innerHTML = text;
        //                 Ustra.docReady(function() {
        //                     Array.from(container.querySelectorAll("script")).forEach(function(item) {
        //                         eval.apply(this, [item.textContent]);
        //                     });
        //                     if(!_.isEmpty(window[popId])) {
        //                         window[popId].open(options);
        //                     }
        //                 }, container);
        //             });
        //     }
        // }

    </script>

</div>

</html>